$def with (selectedAY, fullMountingPlan)  

$ title_string = 'Edit All Mountings and Quotas'

$var title:$title_string
$ home = ['/', 'Home']
$ editAll = ['#', title_string]

$var hierarchy = [home, editAll]

<script type="text/javascript">
    //Disable quota input when mounting is unchecked, enable quota input when checked
    function toggleQuotaState(id) {
        var state = document.getElementById(id).disabled;
        document.getElementById(id).disabled = !state;
    }

    //Add red highlight to mounting and quota if mounting is changed
    function checkMountingChange(element, oldMounting, oldQuota, mountingID, quotaID) {
        var oldMounting = (oldMounting == 1);
        var newMounting = element.checked;

        if (oldMounting != newMounting) {
            addRedHighlight(mountingID);
            addRedHighlight(quotaID);
        } else {
            removeRedHighlight(mountingID);
            removeRedHighlight(quotaID);
            if (oldMounting == 1) {
                checkQuotaChange(document.getElementById(quotaID), oldQuota, quotaID)
            }
        }
    }

    //Add red highlight to quota if quota is changed
    function checkQuotaChange(element, oldQuota, quotaID) {
        var newQuota = element.value;

        if (oldQuota == '?') oldQuota = '';
        if (oldQuota != newQuota) {
            addRedHighlight(quotaID);
        } else {
            removeRedHighlight(quotaID);
        }
    }

    function addRedHighlight(id) {
        document.getElementById(id).parentElement.style.backgroundColor = "#ffaea5";
    }

    function removeRedHighlight(id) {
        document.getElementById(id).parentElement.style.backgroundColor = "white";
    }
</script>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <h1 class="text-center"><b>Edit All Mountings and Quotas in <u>$selectedAY</u></b></h1>
            <p class="text-center">Edit the mountings and quotas for the AY <b>one year after the current AY</b>.</p>
            <br>
            <table class="table table-bordered table-hover text-center display dataTable" id="tentative-mounting-table">
                <thead>
                    <tr>
                        <th>Code</th>
                        <th>Name</th>
                        <th data-sortable="false">Mounted In Sem 1</th>
                        <th data-sortable="false">Sem 1 Quota</th>
                        <th data-sortable="false">Mounted In Sem 2</th>
                        <th data-sortable="false">Sem 2 Quota</th>
                    </tr>
                </thead>
                <tbody>
                    <form id="edit-all-form" name="edit-all-form" action="/editAll" method="post"> 
                    $for subplan in fullMountingPlan:
                        $ moduleCode = subplan[0]
                        $ moduleName = subplan[1]
                        $ sem1Mounting = subplan[2]
                        $ sem2Mounting = subplan[3]
                        $ sem1Quota = subplan[4]
                        $ sem2Quota = subplan[5]
                        $ sem1MountingOption = moduleCode + "_Sem1Mounting"
                        $ sem2MountingOption = moduleCode + "_Sem2Mounting"
                        $ sem1QuotaInput = moduleCode + "_Sem1Quota"
                        $ sem2QuotaInput = moduleCode + "_Sem2Quota"
                        <tr>
                            <td class="text-center">
                                <a href="/viewModule?code=$moduleCode" target="_blank" data-toggle="tooltip" title="View general info for $moduleCode">$moduleCode</a>
                            </td>
                            <td>$moduleName</td>

                        $if sem1Mounting == 1:
                            <td>
                                <input type="checkbox" onclick="toggleQuotaState('$sem1QuotaInput'); checkMountingChange(this, '$sem1Mounting', '$sem1Quota', '$sem1MountingOption', '$sem1QuotaInput');" id="$sem1MountingOption" name="$sem1MountingOption" value="sem1Mounting" checked>
                            </td>
                        $elif sem1Mounting == 0:
                            <td>
                                <input type="checkbox" onclick="toggleQuotaState('$sem1QuotaInput'); checkMountingChange(this, '$sem1Mounting', '$sem1Quota', '$sem1MountingOption', '$sem1QuotaInput');" id="$sem1MountingOption" name="$sem1MountingOption" value="sem1Mounting">
                            </td>
                        $elif sem1Mounting == -1:
                            <td>
                                <input type="checkbox" onclick="toggleQuotaState('$sem1QuotaInput'); checkMountingChange(this, '$sem1Mounting', '$sem1Quota', '$sem1MountingOption', '$sem1QuotaInput');" id="$sem1MountingOption" name="$sem1MountingOption" value="sem1Mounting">
                            </td>

                        $if sem1Quota == '-':
                            <td>
                                <input type="number" min="0" id="$sem1QuotaInput" id="$sem1QuotaInput" name="$sem1QuotaInput" disabled>
                            </td>
                        $elif sem1Quota == '?':
                            <td>
                                <input type="number" min="0" onchange="checkQuotaChange(this, '$sem1Quota', '$sem1QuotaInput');" 
                                id="$sem1QuotaInput" name="$sem1QuotaInput">
                            </td>
                        $else:
                            <td>
                                <input type="number" min="0" onchange="checkQuotaChange(this, '$sem1Quota', '$sem1QuotaInput');" 
                                id="$sem1QuotaInput" name="$sem1QuotaInput" value="$sem1Quota">
                            </td>

                        $if sem2Mounting == 1:
                            <td>
                                <input type="checkbox" onclick="toggleQuotaState('$sem2QuotaInput'); checkMountingChange(this, '$sem2Mounting', '$sem2Quota', '$sem2MountingOption', '$sem2QuotaInput');" id="$sem2MountingOption" name="$sem2MountingOption" value="sem2Mounting" checked>
                            </td>
                        $elif sem2Mounting == 0:
                            <td>
                                <input type="checkbox" onclick="toggleQuotaState('$sem2QuotaInput'); checkMountingChange(this, '$sem2Mounting', '$sem2Quota', '$sem2MountingOption', '$sem2QuotaInput');" id="$sem2MountingOption" name="$sem2MountingOption" value="sem2Mounting">
                            </td>
                        $elif sem2Mounting == -1:
                            <td>
                                <input type="checkbox" onclick="toggleQuotaState('$sem2QuotaInput'); checkMountingChange(this, '$sem2Mounting', '$sem2Quota', '$sem2MountingOption', '$sem2QuotaInput');" id="$sem2MountingOption" name="$sem2MountingOption" value="sem2Mounting">
                            </td>

                        $if sem2Quota == '-':
                            <td>
                                <input type="text" id="$sem2QuotaInput" name="$sem2QuotaInput" disabled>
                            </td>
                        $elif sem2Quota == '?':
                            <td>
                                <input type="text" onchange="checkQuotaChange(this, '$sem2Quota', '$sem2QuotaInput');" 
                                id="$sem2QuotaInput" name="$sem2QuotaInput">
                            </td>
                        $else:
                            <td>
                                <input type="text" onchange="checkQuotaChange(this, '$sem2Quota', '$sem2QuotaInput');" 
                                id="$sem2QuotaInput" name="$sem2QuotaInput" value="$sem2Quota">
                            </td>
                        </tr>
                    <input class="btn btn-primary" type="submit" value="Submit">
                    </form>
                </tbody>
            </table>
            <br>
            <br>
        </div>
    </div>
</div>
